<!DOCTYPE html><!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]--><!--[if gt IE 8]><!--><html xmlns="http://www.w3.org/1999/xhtml" class=" js flexbox canvas canvastext webgl no-touch geolocation postmessage websqldatabase indexeddb hashchange history draganddrop websockets rgba hsla multiplebgs backgroundsize borderimage borderradius boxshadow textshadow opacity cssanimations csscolumns cssgradients cssreflections csstransforms csstransforms3d csstransitions fontface generatedcontent video audio localstorage sessionstorage webworkers applicationcache svg inlinesvg smil svgclippaths" lang="en" style=""><!--<![endif]--><head>
  <meta charset="utf-8" />
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Scheduler middleware — Scrapy 0.9 documentation</title>
  

  
  

  

  
  
    

  

  
  

  
    <link rel="stylesheet" href="https://media.readthedocs.org/css/sphinx_rtd_theme.css" type="text/css" />
  

  
    <link rel="top" title="Scrapy 0.9 documentation" href="../index.html" />
        <link rel="up" title="Experimental features" href="index.html" />
        <link rel="next" title="CrawlSpider v2" href="crawlspider-v2.html" />
        <link rel="prev" title="DjangoItem" href="djangoitems.html" /> 

  
  <script type="text/javascript" async="" src="https://ssl.google-analytics.com/ga.js"></script><script src="../_static/js/modernizr.min.js"></script>


<!-- RTD Extra Head -->

<!-- 
Always link to the latest version, as canonical.
http://docs.readthedocs.org/en/latest/canonical.html
-->
<link rel="canonical" href="http://doc.scrapy.org/en/latest/experimental/scheduler-middleware.html" />

<link rel="stylesheet" href="https://media.readthedocs.org/css/readthedocs-doc-embed.css" type="text/css" />

<script type="text/javascript" src="../_static/readthedocs-data.js"></script>

<!-- Add page-specific data, which must exist in the page js, not global -->
<script type="text/javascript">
READTHEDOCS_DATA['page'] = 'experimental/scheduler-middleware'
</script>

<script type="text/javascript" src="../_static/readthedocs-dynamic-include.js"></script>

<!-- end RTD <extrahead> --></head>

<body class="wy-body-for-nav" role="document" style="">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="../index.html" class="icon icon-home"> Scrapy
          

          
          </a>

          
            
            
            
              <div class="version">
                0.9
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul>
<li class="toctree-l1"><a class="reference internal" href="../intro/overview.html">Scrapy at a glance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/install.html">Installation guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/tutorial.html">Scrapy Tutorial</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../topics/items.html">Items</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/spiders.html">Spiders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/link-extractors.html">Link Extractors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/selectors.html">XPath Selectors</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/loaders.html">Item Loaders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/shell.html">Scrapy shell</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/item-pipeline.html">Item Pipeline</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../topics/logging.html">Logging</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/stats.html">Stats Collection</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/email.html">Sending e-mail</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/telnetconsole.html">Telnet Console</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/webservice.html">Web Service</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../faq.html">Frequently Asked Questions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/firefox.html">Using Firefox for scraping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/firebug.html">Using Firebug for scraping</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/leaks.html">Debugging memory leaks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/images.html">Downloading Item Images</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../topics/architecture.html">Architecture overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/downloader-middleware.html">Downloader Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/spider-middleware.html">Spider Middleware</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/extensions.html">Extensions</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../topics/scrapy-ctl.html">scrapy-ctl.py</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/request-response.html">Requests and Responses</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/settings.html">Settings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/signals.html">Signals</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/exceptions.html">Exceptions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../topics/exporters.html">Item Exporters</a></li>
</ul>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../contributing.html">Contributing to Scrapy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api-stability.html">Versioning and API Stability</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html"><span class="toctree-expand"></span>Experimental features</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="djangoitems.html">DjangoItem</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href=""><span class="toctree-expand"></span>Scheduler middleware</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#activating-a-scheduler-middleware">Activating a scheduler middleware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#writing-your-own-scheduler-middleware">Writing your own scheduler middleware</a></li>
<li class="toctree-l3"><a class="reference internal" href="#built-in-scheduler-middleware-reference"><span class="toctree-expand"></span>Built-in scheduler middleware reference</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#module-scrapy.contrib.schedulermiddleware.duplicatesfilter">DuplicatesFilterMiddleware</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="crawlspider-v2.html">CrawlSpider v2</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      <div id="rtd-47nth9dy" class="ethical-rtd ethical-dark-theme"></div></div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">Scrapy</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          





<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> »</li>
      
          <li><a href="index.html">Experimental features</a> »</li>
      
    <li>Scheduler middleware</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="https://github.com/scrapy/scrapy/blob/0.9/docs/experimental/scheduler-middleware.rst" class="fa fa-github"> Edit on GitHub</a>
          
        
      </li>
  </ul>
  <hr />
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="scheduler-middleware">
<span id="topics-scheduler-middleware"></span><h1>Scheduler middleware<a class="headerlink" href="#scheduler-middleware" title="Permalink to this headline">¶</a></h1>
<p>The scheduler middleware is a framework of hooks in the Scrapy scheduling
mechanism where you can plug custom functionality to process requests being
enqueued.</p>
<div class="section" id="activating-a-scheduler-middleware">
<h2>Activating a scheduler middleware<a class="headerlink" href="#activating-a-scheduler-middleware" title="Permalink to this headline">¶</a></h2>
<p>To activate a scheduler middleware component, add it to the
<a class="reference internal" href="../topics/settings.html#std:setting-SCHEDULER_MIDDLEWARES"><code class="xref std std-setting docutils literal"><span class="pre">SCHEDULER_MIDDLEWARES</span></code></a> setting, which is a dict whose keys are the
middleware class path and their values are the middleware orders.</p>
<p>Here’s an example:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span><span class="n">SCHEDULER_MIDDLEWARES</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">'myproject.middlewares.CustomSchedulerMiddleware'</span><span class="p">:</span> <span class="mi">543</span><span class="p">,</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The <a class="reference internal" href="../topics/settings.html#std:setting-SCHEDULER_MIDDLEWARES"><code class="xref std std-setting docutils literal"><span class="pre">SCHEDULER_MIDDLEWARES</span></code></a> setting is merged with the
<a class="reference internal" href="../topics/settings.html#std:setting-SCHEDULER_MIDDLEWARES_BASE"><code class="xref std std-setting docutils literal"><span class="pre">SCHEDULER_MIDDLEWARES_BASE</span></code></a> setting defined in Scrapy (and not meant
to be overridden) and then sorted by order to get the final sorted list of
enabled middlewares: the first middleware is the one closer to the engine and
the last is the one closer to the scheduler.</p>
<p>To decide which order to assign to your middleware see the
<a class="reference internal" href="../topics/settings.html#std:setting-SCHEDULER_MIDDLEWARES_BASE"><code class="xref std std-setting docutils literal"><span class="pre">SCHEDULER_MIDDLEWARES_BASE</span></code></a> setting and pick a value according to
where you want to insert the middleware. The order does matter because each
middleware performs a different action and your middleware could depend on some
previous (or subsequent) middleware being applied.</p>
<p>If you want to disable a builtin middleware (the ones defined in
<a class="reference internal" href="../topics/settings.html#std:setting-SCHEDULER_MIDDLEWARES_BASE"><code class="xref std std-setting docutils literal"><span class="pre">SCHEDULER_MIDDLEWARES_BASE</span></code></a>, and enabled by default) you must define it
in your project <a class="reference internal" href="../topics/settings.html#std:setting-SCHEDULER_MIDDLEWARES"><code class="xref std std-setting docutils literal"><span class="pre">SCHEDULER_MIDDLEWARES</span></code></a> setting and assign <cite>None</cite> as its
value.  For example, if you want to disable the duplicates filter middleware:</p>
<div class="highlight-python"><div class="highlight"><pre><span></span>SCHEDULER_MIDDLEWARES = {
    'myproject.middlewares.CustomSchedulerMiddleware': 543,
    'scrapy.contrib.schedulermiddleware.duplicatesfilter.DuplicatesFilterMiddleware: None,
}
</pre></div>
</div>
<p>Finally, keep in mind that some middlewares may need to be enabled through a
particular setting. See each middleware documentation for more info.</p>
</div>
<div class="section" id="writing-your-own-scheduler-middleware">
<h2>Writing your own scheduler middleware<a class="headerlink" href="#writing-your-own-scheduler-middleware" title="Permalink to this headline">¶</a></h2>
<p>Writing your own scheduler middleware is easy. Each middleware component is a
single Python class that defines one or more of the following methods:</p>
<span class="target" id="module-scrapy.contrib.schedulermiddleware"></span><dl class="class">
<dt id="scrapy.contrib.schedulermiddleware.SchedulerMiddleware">
<em class="property">class </em><code class="descclassname">scrapy.contrib.schedulermiddleware.</code><code class="descname">SchedulerMiddleware</code><a class="headerlink" href="#scrapy.contrib.schedulermiddleware.SchedulerMiddleware" title="Permalink to this definition">¶</a></dt>
<dd><dl class="method">
<dt id="scrapy.contrib.schedulermiddleware.SchedulerMiddleware.enqueue_request">
<code class="descname">enqueue_request</code><span class="sig-paren">(</span><em>spider</em>, <em>request</em><span class="sig-paren">)</span><a class="headerlink" href="#scrapy.contrib.schedulermiddleware.SchedulerMiddleware.enqueue_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Process the given request which is being enqueued. This method can return
None to avoid the request from being scheduled.</p>
<p><a class="reference internal" href="#scrapy.contrib.schedulermiddleware.SchedulerMiddleware.enqueue_request" title="scrapy.contrib.schedulermiddleware.SchedulerMiddleware.enqueue_request"><code class="xref py py-meth docutils literal"><span class="pre">enqueue_request()</span></code></a> should return either <code class="docutils literal"><span class="pre">None</span></code>, a
<a class="reference internal" href="../topics/request-response.html#scrapy.http.Response" title="scrapy.http.Response"><code class="xref py py-class docutils literal"><span class="pre">Response</span></code></a> object or a <code class="docutils literal"><span class="pre">Deferred</span></code>.</p>
<table class="docutils field-list" frame="void" rules="none">
<colgroup><col class="field-name" />
<col class="field-body" />
</colgroup><tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>spider</strong> (<a class="reference internal" href="../topics/spiders.html#scrapy.spider.BaseSpider" title="scrapy.spider.BaseSpider"><code class="xref py py-class docutils literal"><span class="pre">BaseSpider</span></code></a> object) – the spider originating the request</li>
<li><strong>requests</strong> – the request to be enqueued</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="built-in-scheduler-middleware-reference">
<span id="topics-scheduler-middleware-ref"></span><h2>Built-in scheduler middleware reference<a class="headerlink" href="#built-in-scheduler-middleware-reference" title="Permalink to this headline">¶</a></h2>
<p>This page describes all scheduler middleware components that come with
Scrapy.</p>
<p>For a list of the components enabled by default (and their orders) see the
<a class="reference internal" href="../topics/settings.html#std:setting-SCHEDULER_MIDDLEWARES_BASE"><code class="xref std std-setting docutils literal"><span class="pre">SCHEDULER_MIDDLEWARES_BASE</span></code></a> setting.</p>
<div class="section" id="module-scrapy.contrib.schedulermiddleware.duplicatesfilter">
<span id="duplicatesfiltermiddleware"></span><h3>DuplicatesFilterMiddleware<a class="headerlink" href="#module-scrapy.contrib.schedulermiddleware.duplicatesfilter" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="scrapy.contrib.schedulermiddleware.duplicatesfilter.DuplicatesFilterMiddleware">
<em class="property">class </em><code class="descclassname">scrapy.contrib.schedulermiddleware.duplicatesfilter.</code><code class="descname">DuplicatesFilterMiddleware</code><a class="headerlink" href="#scrapy.contrib.schedulermiddleware.duplicatesfilter.DuplicatesFilterMiddleware" title="Permalink to this definition">¶</a></dt>
<dd><p>Filter out already visited urls.</p>
<p>The <a class="reference internal" href="#scrapy.contrib.schedulermiddleware.duplicatesfilter.DuplicatesFilterMiddleware" title="scrapy.contrib.schedulermiddleware.duplicatesfilter.DuplicatesFilterMiddleware"><code class="xref py py-class docutils literal"><span class="pre">DuplicatesFilterMiddleware</span></code></a> can be configured through the following
settings (see the settings documentation for more info):</p>
<blockquote>
<div><ul class="simple">
<li><a class="reference internal" href="../topics/settings.html#std:setting-DUPEFILTER_CLASS"><code class="xref std std-setting docutils literal"><span class="pre">DUPEFILTER_CLASS</span></code></a> - The class that implements the duplicate
filtering policy.</li>
</ul>
</div></blockquote>
</dd></dl>

</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="crawlspider-v2.html" class="btn btn-neutral float-right" title="CrawlSpider v2" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="djangoitems.html" class="btn btn-neutral" title="DjangoItem" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr /><div><div id="rtd-pc1dhv1k" class="ethical-rtd"></div></div>

  <div role="contentinfo">
    <p>
        © Copyright 2008-2010, Insophia.
      
        <span class="commit">
          Revision <code>6525d3fe</code>.
        </span>
      

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <div class="rst-versions" data-toggle="rst-versions" role="note" aria-label="versions">
    <span class="rst-current-version" data-toggle="rst-current-version">
      <span class="fa fa-book"> Read the Docs</span>
      v: 0.9
      <span class="fa fa-caret-down"></span>
    </span>
    <div class="rst-other-versions">
      <dl>
        <dt>Versions</dt>
        
          <dd><a href="/en/latest/">latest</a></dd>
        
          <dd><a href="/en/stable/">stable</a></dd>
        
          <dd><a href="/en/master/">master</a></dd>
        
          <dd><a href="/en/1.1/">1.1</a></dd>
        
          <dd><a href="/en/1.0/">1.0</a></dd>
        
          <dd><a href="/en/0.24/">0.24</a></dd>
        
          <dd><a href="/en/0.22/">0.22</a></dd>
        
          <dd><a href="/en/0.20/">0.20</a></dd>
        
          <dd><a href="/en/0.18/">0.18</a></dd>
        
          <dd><a href="/en/0.16/">0.16</a></dd>
        
          <dd><a href="/en/0.14/">0.14</a></dd>
        
          <dd><a href="/en/0.12/">0.12</a></dd>
        
          <dd><a href="/en/0.10.3/">0.10.3</a></dd>
        
          <dd><a href="/en/0.9/">0.9</a></dd>
        
      </dl>
      <dl>
        <dt>Downloads</dt>
        
          <dd><a href="//readthedocs.org/projects/scrapy/downloads/pdf/0.9/">pdf</a></dd>
        
          <dd><a href="//readthedocs.org/projects/scrapy/downloads/htmlzip/0.9/">htmlzip</a></dd>
        
          <dd><a href="//readthedocs.org/projects/scrapy/downloads/epub/0.9/">epub</a></dd>
        
      </dl>
      <dl>
        <dt>On Read the Docs</dt>
          <dd>
            <a href="//readthedocs.org/projects/scrapy/?fromdocs=scrapy">Project Home</a>
          </dd>
          <dd>
            <a href="//readthedocs.org/builds/scrapy/?fromdocs=scrapy">Builds</a>
          </dd>
      </dl>
      <hr />
      Free document hosting provided by <a href="http://www.readthedocs.org">Read the Docs</a>.

    </div>
  </div>



  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'0.9',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-2.0.3.min.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/jquery/jquery-migrate-1.2.1.min.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/underscore.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/doctools.js"></script>
      <script type="text/javascript" src="https://media.readthedocs.org/javascript/readthedocs-doc-embed.js"></script>

  

  
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   


<div id="rtd-m00jfpu5"><div class="ethical-fixedfooter"><div class="ethical-content"><div class="ethical-close"><a href="javascript:$('.ethical-fixedfooter').hide()" aria-label="Close Ad">×</a></div><img src="https://readthedocs.org/sustainability/view/641/QV5MkXQkwMde/" class="ethical-pixel" /><div><a href="https://readthedocs.org/sustainability/click/641/QV5MkXQkwMde/" rel="nofollow" target="_blank"><span class="ethical-text"></span></a><a href="https://readthedocs.org/sustainability/click/641/QV5MkXQkwMde/" rel="nofollow" target="_blank">Private repos and priority support. Try Read the Docs for Business Today!</a><span class="ethical-callout"><small><em><a href="https://docs.readthedocs.io/en/latest/ethical-advertising.html" rel="nofollow" target="_blank">ads served ethically</a></em></small></span></div></div></div></div></body></html>